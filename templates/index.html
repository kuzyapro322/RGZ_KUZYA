{% extends "base.html" %}

{% block content %}
{% if session.is_admin %}
<div class="admin-actions">
    <a href="{{ url_for('admin.add_book') }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
</div>
{% endif %}
<div class="filters-section">
    <h2>–§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h2>
    <form method="GET" action="{{ url_for('main.index') }}#books-grid" class="filter-form">
        <div class="filter-row">
            <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏" value="{{ filters.title }}">
            
            <!-- –ó–ê–ú–ï–ù–Ø–ï–ú –ò–ù–ü–£–¢ –ê–í–¢–û–†–ê –ù–ê –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö -->
            <select name="author" class="filter-select">
                <option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>
                {% for author in authors %}
                <option value="{{ author }}" {% if filters.author == author %}selected{% endif %}>
                    {{ author }}
                </option>
                {% endfor %}
            </select>
            
            <!-- –ó–ê–ú–ï–ù–Ø–ï–ú –ò–ù–ü–£–¢ –ò–ó–î–ê–¢–ï–õ–¨–°–¢–í–ê –ù–ê –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö -->
            <select name="publisher" class="filter-select">
                <option value="">–í—Å–µ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</option>
                {% for publisher in publishers %}
                <option value="{{ publisher }}" {% if filters.publisher == publisher %}selected{% endif %}>
                    {{ publisher }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-row">
            <div class="pages-range">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label>
                <input type="number" name="pages_min" placeholder="–û—Ç" min="1" value="{{ filters.pages_min }}">
                <span>-</span>
                <input type="number" name="pages_max" placeholder="–î–æ" min="1" value="{{ filters.pages_max }}">
            </div>
        </div>
        <div class="filter-buttons">
            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{{ url_for('main.index') }}#books-grid" class="btn btn-outline">–û—á–∏—Å—Ç–∏—Ç—å</a>
        </div>
    </form>
</div>

<div class="sorting-section">
    <h3>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</h3>
    <div class="sort-controls">
        <form method="GET" action="{{ url_for('main.index') }}#books-grid" id="sortForm">
            <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ -->
            <input type="hidden" name="title" value="{{ filters.title }}">
            <input type="hidden" name="author" value="{{ filters.author }}">
            <input type="hidden" name="publisher" value="{{ filters.publisher }}">
            <input type="hidden" name="pages_min" value="{{ filters.pages_min }}">
            <input type="hidden" name="pages_max" value="{{ filters.pages_max }}">
            
            <select name="sort_field" onchange="document.getElementById('sortForm').submit()">
                <option value="title" {% if sort_field == 'title' %}selected{% endif %}>–ù–∞–∑–≤–∞–Ω–∏–µ</option>
                <option value="author" {% if sort_field == 'author' %}selected{% endif %}>–ê–≤—Ç–æ—Ä</option>
                <option value="pages" {% if sort_field == 'pages' %}selected{% endif %}>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü</option>
                <option value="publisher" {% if sort_field == 'publisher' %}selected{% endif %}>–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</option>
            </select>
            
            <select name="sort_order" onchange="document.getElementById('sortForm').submit()">
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
            </select>
        </form>
    </div>
</div>

<div class="books-header">
    <h2>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h2>
    <div class="books-count">–ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: {{ total_count }}</div>
</div>

<div class="books-grid">
    {% for book in books %}
    <div class="book-card">
        <img src="/static/pic/{{ book.cover_image or 'default_cover.jpg' }}" 
                alt="{{ book.title }}"
                {% if session.username %}
                onclick="showBook(this)"
                data-title="{{ book.title }}"
                data-author="{{ book.author }}"
                data-pages="{{ book.pages }}"
                data-publisher="{{ book.publisher }}"
                {% endif %}
                onerror="this.src='/static/default_cover.jpg'">
        <h3>{{ book.title }}</h3>
        <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ book.author }}</p>
        <p><strong>–°—Ç—Ä–∞–Ω–∏—Ü:</strong> {{ book.pages }}</p>
        <p><strong>–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ:</strong> {{ book.publisher }}</p>

        {% if session.is_admin %}
        <div class="book-actions">
            <a href="{{ url_for('admin.edit_book', book_id=book.id) }}" 
               class="btn btn-outline btn-small">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <form method="POST" 
                  action="{{ url_for('admin.delete_book', book_id=book.id) }}" 
                  class="delete-form"
                  onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É ¬´{{ book.title }}¬ª?')">
                <button type="submit" class="btn btn-danger btn-small">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </form>
        </div>
        {% endif %}

    </div>
    {% else %}
    <div class="no-books">
        <p>–ö–Ω–∏–≥–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    </div>
    {% endfor %}
</div>

<!-- –ö–ù–û–ü–ö–ê "–ü–û–ö–ê–ó–ê–¢–¨ –ï–©–ï" -->
{% if has_next %}
<div class="load-more-section">
    <a href="{{ url_for('main.index', page=current_page+1, sort_field=sort_field, sort_order=sort_order,
                       title=filters.title, author=filters.author, publisher=filters.publisher,
                       pages_min=filters.pages_min, pages_max=filters.pages_max) }}" 
       class="btn btn-primary btn-large"
       onclick="return loadMoreBooks(this)">
        –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ
    </a>
</div>
{% endif %}
{% endblock %}